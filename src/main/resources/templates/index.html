<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DB 대여 시스템</title>
</head>
<body>
    <div>
        <h2>MySQL 데이터베이스 대여 현황</h2>
        <a href="/user/logout">로그아웃</a>
        <h3>데이터베이스 이름</h3>
        <div style="border: 1px solid gray; padding: 4px;">
            <h4>접속 정보</h4>
            <div>host: db.uomaep.com</div>
            <div>port: 23306</div>
            <div>database: #보유한 데이터베이스 명#</div>
            <div>username: 계정 아이디</div>
            <div>password: 계정 패스워드</div>
        </div>
        <br>
        <form id="createForm">
            <label for="databaseName">데이터베이스 이름: </label>
            <input type="text" id="databaseName" name="databaseName" />
            <button type="submit">생성하기</button>
        </form>
        <ul>
            <li th:each="info: ${databases}">
                <span th:text="${info.databaseName}"></span>
                <button>삭제</button>
            </li>
        </ul>
    </div>

    <script>
        document.getElementById("createForm").addEventListener("submit", function(e) {
            e.preventDefault(); // 폼 기본 제출 막기

            const formData = new FormData(this);
            const databaseName = formData.get("databaseName");

            fetch("/database/create", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: new URLSearchParams({ databaseName })
            })
                .then(response => response.json())
                .then(data => {
                    alert(data.msg);
                    if (data.result) {
                        // 성공 시 페이지 새로고침으로 목록 반영
                        window.location.reload();
                    }
                })
                .catch(err => {
                    alert("서버 오류가 발생했습니다.");
                    console.error(err);
                });
        });
    </script>
</body>
</html>